name: PR Badge Comment

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  comment-badges:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
      - name: Set up Python
        uses: actions/setup-python@e797f83bcb11b83ae66e0230d6156d7c80228e7c # v6
        with:
          python-version: '3.14'
      - name: Generate random slugs
        id: random_slugs
        run: |
          pip install simpleicons==7.21.0
          SLUGS=$(python3 -c "from simpleicons.all import icons; import random; slugs = random.sample(list(icons), 25); print(' '.join(slugs))")
          if [ -z "$SLUGS" ]; then
            echo "Error: Failed to generate random slugs"
            exit 1
          fi
          echo "slugs=$SLUGS" >> $GITHUB_OUTPUT
      - name: Generate hilbert badges using local Docker action
        id: hilbert
        uses: ./
        with:
          slugs: ${{ steps.random_slugs.outputs.slugs }}
          sort: hilbert
          style: flat
          format: html

      - name: Generate hsv badges using local Docker action
        id: hsv
        uses: ./
        with:
          slugs: ${{ steps.random_slugs.outputs.slugs }}
          sort: hsv
          style: flat
          format: html

      - name: Generate step badges using local Docker action
        id: step
        uses: ./
        with:
          slugs: ${{ steps.random_slugs.outputs.slugs }}
          sort: step
          style: flat
          format: html

      - name: Generate step_invert badges using local Docker action
        id: step_invert
        uses: ./
        with:
          slugs: ${{ steps.random_slugs.outputs.slugs }}
          sort: step_invert
          style: flat
          format: html

      - name: Generate luminance badges using local Docker action
        id: luminance
        uses: ./
        with:
          slugs: ${{ steps.random_slugs.outputs.slugs }}
          sort: luminance
          style: flat
          format: html

      - name: Generate badgen badges using local Docker action
        id: badgen
        uses: ./
        with:
          slugs: ${{ steps.random_slugs.outputs.slugs }}
          sort: hilbert
          provider: badgen
          format: html
      - name: Post PR comment for Shields.io tests
        uses: peter-evans/create-or-update-comment@e8674b075228eee787fea43ef493e45ece1004c9 # v5
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ## 🏷️ Test Badge Generation (Shields.io)
            ### hilbert
            ${{ steps.hilbert.outputs.badges }}

            ### hsv
            ${{ steps.hsv.outputs.badges }}

            ### step
            ${{ steps.step.outputs.badges }}

            ### step_invert
            ${{ steps.step_invert.outputs.badges }}

            ### luminance
            ${{ steps.luminance.outputs.badges }}

      - name: Post PR comment for Badgen test
        uses: peter-evans/create-or-update-comment@e8674b075228eee787fea43ef493e45ece1004c9 # v5
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ## 🏷️ Test Badge Generation (Badgen.net)
            ### hilbert
            ${{ steps.badgen.outputs.badges }}
